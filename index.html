 <!DOCTYPE html>
<html>
  <head>
  <script type="text/javascript">
window.onerror = function(msg, url, line, col, error) {
   // Note that col & error are new to the HTML 5 spec and may not be 
   // supported in every browser.  It worked for me in Chrome.
   var extra = !col ? '' : '\ncolumn: ' + col;
   extra += !error ? '' : '\nerror: ' + error;

   // You can view the information in an alert to see things working like this:
   alert("Error: " + msg + "\nurl: " + url + "\nline: " + line + extra);

   // TODO: Report this error via ajax so you can keep track
   //       of what pages have JS issues

   var suppressErrorAlert = true;
   // If you return true, then error alerts (like in older versions of 
   // Internet Explorer) will be suppressed.
   return suppressErrorAlert;
};
</script>
    <title>Nodewords 1459</title>
    <script>
    var guessed = new Array();
    var word = "";
    var shown = "";
    var guesses = 0;
    var lives = 5;
    var definition = "";
 
    function loadFile(filePath) {
		var result = null;
		var xmlhttp = new XMLHttpRequest();
		xmlhttp.open("GET", filePath, false);
		xmlhttp.send();
		if (xmlhttp.status==200) {
			result = xmlhttp.responseText;
		}
		return result;
	}
	
	//str = setCharAt(str,4,'a');
	function setCharAt(str,index,chr) {
		if(index > str.length-1) return str;
		return str.substr(0,index) + chr + str.substr(index+1);
	}

	function sendguess(){
		if (word == ""){
			alert("Press New Game first.")
			return
		}
		value = document.getElementById("wentry").value;
		
		if (value.length > 1 && value == word){
			document.getElementById("shownWord").innerHTML = word+"<br>"+definition;
			document.getElementById("shownWord").style.color = "darkgreen";
			word = "";
			alert("Win!");
		}else if(value.length == 1 && word.indexOf(value) > -1){
			if (guessed.includes(value) || shown.includes(value)){
				alert("You already guessed that.");
			}else{
				alert("The word contains "+value);
				shown = setCharAt(shown, word.indexOf(value), value)
				document.getElementById("shownWord").innerHTML = shown;
			}
		}else{
			if (guessed.includes(value)){
				alert("You already guessed that.")
			}else{
				if (value.length == 1){
					lives -= 1
					alert("Incorrect character. ("+lives+" lives remaining.)");
					guessed.push(value);
					document.getElementById("guesses").innerHTML = guessed.join("<br>");
					document.getElementById("lives").innerHTML = lives;
					document.getElementById("lives").style.color = "darkgold"
				}else{
					lives -= 3
					alert("Incorrect word guess. ("+lives+" lives remaining.)");
					guessed.push(value);
					document.getElementById("guesses").innerHTML = guessed.join("<br>");
					document.getElementById("lives").innerHTML = lives;
					document.getElementById("lives").style.color = "darkgold"
				}
				if (lives <= 0){
					document.getElementById("shownWord").innerHTML = word+"<br>"+definition;
					document.getElementById("shownWord").style.color = "red"
					document.getElementById("lives").style.color = "red"
					word = ""
					alert("Game over.");
				}
			}
		}
	}
	function pickRandomProperty(obj) {
		var result;
		var count = 0;
		for (var prop in obj)
			if (Math.random() < 1/++count)
			result = prop;
		return result;
	}
	
	function newgame(){
		if (confirm("Start a new game?")){
			//console.log("Begin")
			guessed = new Array();
			word = "";
			shown = "";
			definition = "";
			guesses = 0;
			lives = 5;
			document.getElementById("guesses").innerHTML = "None";
			
			var data = JSON.parse(loadFile('https://kaiz0r.github.io/dictionary.json'));
			var new_obj = pickRandomProperty(data);
			
			definition = data[new_obj];
			word = new_obj.toLowerCase();
			alert(word+" - "+definition);
			document.getElementById("shownWord").innerHTML = "*".repeat(word.length);
			document.getElementById("shownWord").style.color = "black"
			document.getElementById("lives").innerHTML = lives;
			document.getElementById("lives").style.color = "green"
		}
	}
		
	</script>
  </head>
  <body>
    <label id="shownWord">Press new game.</label><br>
	Guess: <input type="text" name="input" id="wentry"><button onclick="sendguess()">Send Guess</button><button onclick="newgame()">New Game</button><br>
	â™¥ <label id="lives">0</label> lives.<br>
	<label id="guesses">None.</label>
  </body>
</html>
